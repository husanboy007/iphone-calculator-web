<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>Begim iPhone Kalkulyator</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #333 0, #000 55%, #000 100%);
      color: #fff;
    }

    .calc-wrapper {
      background: #000;
      border-radius: 32px;
      padding: 20px 16px 28px;
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(255, 255, 255, 0.05);
      width: 320px;
      max-width: 100%;
    }

    .calc-screen {
      text-align: right;
      margin-bottom: 18px;
      min-height: 80px;
    }

    .calc-history {
      font-size: 14px;
      color: #a1a1a1;
      min-height: 18px;
      opacity: 0.8;
    }

    .calc-main {
      font-size: 40px;
      font-weight: 300;
      word-wrap: break-word;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-auto-rows: 64px;
      gap: 10px;
    }

    button {
      border: none;
      border-radius: 999px;
      font-size: 26px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.06s ease, filter 0.06s ease, box-shadow 0.06s ease;
      outline: none;
      user-select: none;
    }

    button:active {
      transform: scale(0.97);
      filter: brightness(1.2);
      box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    }

    .btn-func {
      background: #a5a5a5;
      color: #000;
      font-size: 20px;
    }

    .btn-num {
      background: #333333;
      color: #fff;
    }

    .btn-op {
      background: #ff9500;
      color: #fff;
      font-size: 30px;
    }

    .btn-zero {
      grid-column: span 2;
      justify-content: flex-start;
      padding-left: 24px;
    }

    .btn-eq {
      background: #ff9500;
      color: #fff;
    }

    @media (max-width: 400px) {
      .calc-wrapper {
        width: 100%;
        margin: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="calc-wrapper">
    <div class="calc-screen">
      <div class="calc-history" id="history"></div>
      <div class="calc-main" id="display">0</div>
    </div>

    <div class="buttons">
      <!-- 1-qator -->
      <button class="btn-func" data-action="ac">AC</button>
      <button class="btn small" data-action="back">‚Üê</button>
      <button class="btn-func" data-action="sign">¬±</button>
      <button class="btn-func" data-action="percent">%</button>
      <button class="btn-op"   data-op="divide">√∑</button>

      <!-- 2-qator -->
      <button class="btn-num" data-num="7">7</button>
      <button class="btn-num" data-num="8">8</button>
      <button class="btn-num" data-num="9">9</button>
      <button class="btn-op"  data-op="multiply">√ó</button>

      <!-- 3-qator -->
      <button class="btn-num" data-num="4">4</button>
      <button class="btn-num" data-num="5">5</button>
      <button class="btn-num" data-num="6">6</button>
      <button class="btn-op"  data-op="minus">‚àí</button>

      <!-- 4-qator -->
      <button class="btn-num" data-num="1">1</button>
      <button class="btn-num" data-num="2">2</button>
      <button class="btn-num" data-num="3">3</button>
      <button class="btn-op"  data-op="plus">+</button>

      <!-- 5-qator -->
      <button class="btn-num btn-zero" data-num="0">0</button>
      <button class="btn-num" data-num=".">.</button>
      <button class="btn-eq"  data-action="equals">=</button>
    </div>
  </div>

<script>
  const display = document.getElementById("display");
  const history = document.getElementById("history");

  let expression = "";        // to'liq ifoda: 6+62*5
  let currentValue = "0";     // ekranda ko'rsatiladigan son
  let justEvaluated = false;  // hozirgina natija chiqdimi-yo'qmi

  function backspace() {
  if (justEvaluated) {
    expression = "";
    currentValue = "0";
    justEvaluated = false;
    updateScreen();
    return;
  }

  if (currentValue.length > 1) {
    currentValue = currentValue.slice(0, -1);
  } else {
    currentValue = "0";
  }

  expression = expression.slice(0, -1);
  updateScreen();
}

  function prettifyNumber(str) {
    // Xatolik bo'lsa aynan o'shani chiqaramiz
    if (str === "Xatolik" || str === "0 ga bo'lib bo'lmaydi") return str;

    const num = Number(str);
    if (!isFinite(num)) return str;

    const isNegative = num < 0;
    let [intPart, decPart] = Math.abs(num).toString().split(".");

    intPart = Number(intPart).toLocaleString("en-US");
    return (isNegative ? "-" : "") + (decPart ? intPart + "." + decPart : intPart);
  }

  function humanExpression(expr) {
    return expr
      .replace(/\*/g, "√ó")
      .replace(/\//g, "√∑");
  }

  function updateScreen() {
    display.textContent = prettifyNumber(currentValue);
    history.textContent = humanExpression(expression);
  }

  // Raqam bosilganda
  function inputNumber(num) {
    if (justEvaluated) {
      currentValue = num;
      expression = num;
      justEvaluated = false;
    } else {
      if (num === "." && currentValue.includes(".")) {
        return; // ikki marta nuqta bo'lmasin
      }
      if (currentValue === "0" && num !== ".") {
        currentValue = num;
      } else {
        currentValue += num;
      }
      expression += num;
    }
    updateScreen();
  }

  // Amallar (+ - √ó √∑)
  function setOperation(op) {
    const opSymbol =
      op === "plus" ? "+" :
      op === "minus" ? "-" :
      op === "multiply" ? "*" :
      op === "divide" ? "/" : "";

    if (justEvaluated) {
      // Natijadan keyin amal bosilsa: ifodani natijadan boshlaymiz
      expression = currentValue + opSymbol;
      justEvaluated = false;
    } else {
      // Oxiri amal bo'lsa, almashtiramiz
      if ("+-*/".includes(expression.slice(-1))) {
        expression = expression.slice(0, -1) + opSymbol;
      } else {
        expression += opSymbol;
      }
    }
    currentValue = "";
    updateScreen();
  }

  // "=" bosilganda ‚Äî butun ifodani hisoblash
  function calculate() {
    if (!expression) return;

    // Oxiri amal bilan tugasa, oxirgi amalni olib tashlaymiz
    if ("+-*/".includes(expression.slice(-1))) {
      expression = expression.slice(0, -1);
    }

    try {
      const result = eval(expression); // bu yerda 6+62*5 ni hisoblaydi
      currentValue = String(result);
      expression = String(result);   // natijadan davom ettirish mumkin bo'lishi uchun
      justEvaluated = true;
      updateScreen();
    } catch (e) {
      currentValue = "Xatolik";
      justEvaluated = true;
      updateScreen();
    }
  }

  // AC
  function clearAll() {
    expression = "";
    currentValue = "0";
    justEvaluated = false;
    updateScreen();
  }

  // +/‚Äì
  function toggleSign() {
    if (!currentValue || currentValue === "0" || currentValue === "Xatolik") return;
    if (currentValue.startsWith("-")) {
      currentValue = currentValue.slice(1);
    } else {
      currentValue = "-" + currentValue;
    }

    // Ifodaning oxirini ham shu qiymatga moslashtiramiz
    const lastOpIndex = Math.max(
      expression.lastIndexOf("+"),
      expression.lastIndexOf("-"),
      expression.lastIndexOf("*"),
      expression.lastIndexOf("/")
    );
    if (lastOpIndex === -1) {
      expression = currentValue;
    } else {
      expression = expression.slice(0, lastOpIndex + 1) + currentValue;
    }
    updateScreen();
  }

  // %
  function percent() {
    const val = parseFloat(currentValue || "0");
    currentValue = String(val / 100);
    // Ifodada ham oxirgi sonni almashtiramiz
    const lastOpIndex = Math.max(
      expression.lastIndexOf("+"),
      expression.lastIndexOf("-"),
      expression.lastIndexOf("*"),
      expression.lastIndexOf("/")
    );
    if (lastOpIndex === -1) {
      expression = currentValue;
    } else {
      expression = expression.slice(0, lastOpIndex + 1) + currentValue;
    }
    updateScreen();
  }

  // üîò Button bosishlar
  document.querySelectorAll(".btn-num").forEach(btn => {
    btn.addEventListener("click", () => inputNumber(btn.dataset.num));
  });

  document.querySelectorAll(".btn-op").forEach(btn => {
    btn.addEventListener("click", () => setOperation(btn.dataset.op));
  });

  document.querySelectorAll("[data-action]").forEach(btn => {
    btn.addEventListener("click", () => {
      const action = btn.dataset.action;
      if (action === "ac") clearAll();
      else if (action === "equals") calculate();
      else if (action === "sign") toggleSign();
      else if (action === "percent") percent();
    });
  });

  // ‚å®Ô∏è Klaviatura qo'llab-quvvatlash
document.addEventListener("keydown", (e) => {
  const key = e.key;

  if (key >= "0" && key <= "9") {
    inputNumber(key);
  } else if (key === ".") {
    inputNumber(".");
  } else if (key === "+") {
    setOperation("plus");
  } else if (key === "-") {
    setOperation("minus");
  } else if (key === "*") {
    setOperation("multiply");
  } else if (key === "/") {
    setOperation("divide");
  } else if (key === "Enter" || key === "=") {
    e.preventDefault();
    calculate();
  } else if (key === "Escape") {
    clearAll();
  } else if (key === "Backspace") {
    backspace();
  }
});
</script>
